namespace Application {
public class FileManager : Object {

    static FileManager? instance;
    private string recipeDirName;

    File file = null;

    FileManager() {
    }
 
    public static FileManager get_instance() {
        if (instance == null) {
            instance = new FileManager();
        }
        return instance;
    }

    public File getFile() {
        return this.file;
    }

    public void setFile(File newFile){
        this.file = newFile;
    }

  public Recipe[] getRecipes (){
        Recipe[] recipes = new Recipe[0];

        try{
            var directory = Dir.open("../recipes");

            while ((recipeDirName = directory.read_name()) != null) {

                var file = getRecipeFile(recipeDirName);

                var recipe = new Recipe();
                recipe.setName(recipeDirName);

                recipes += recipe;
            }
        } catch (Error e){
            new Alert("An error occured", e.message);
        }

        return recipes;
    }

    private File getRecipeFile(string fileName){
        var file = File.new_for_path ("../recipes/" + fileName + "/recipe.md");
        if (!file.query_exists ()) {
            try {
                file.create (FileCreateFlags.REPLACE_DESTINATION, null);
                getRecipeFile(fileName);
            } catch (Error e) {
                error ("%s", e.message);
            }
        }
        return file;
    }
}
}

